
 <!DOCTYPE HTML>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
  
    <title>web数据交互艺术 | microConan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="conan">
    
    <meta name="description" content="Web数据交互艺术
课程对象

前端开发人员
一线开发者、web前端编程技术了解者
作者：张楠

大纲

格式
纯文本
xml
json


http连接
缓存
存储
cookie
localStorage/userData(xml存储640)
web sql、indexedDB


推送
轮询
长">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="microConan" title="microConan"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="microConan">microConan</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:js250.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/02/15/web数据交互艺术/" title="web数据交互艺术" itemprop="url">web数据交互艺术</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://js250.com" title="conan">conan</a>
    </p>
  <p class="article-time">
    <time datetime="2015-02-15T02:32:39.000Z" itemprop="datePublished">2月 15 2015</time>
    Updated:<time datetime="2015-02-15T02:53:59.000Z" itemprop="dateModified">2月 15 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web数据交互艺术"><span class="toc-number">1.</span> <span class="toc-text">Web数据交互艺术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#课程对象"><span class="toc-number">1.0.1.</span> <span class="toc-text">课程对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大纲"><span class="toc-number">1.1.</span> <span class="toc-text">大纲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#格式"><span class="toc-number">1.2.</span> <span class="toc-text">格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http协议"><span class="toc-number">1.3.</span> <span class="toc-text">http协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存"><span class="toc-number">1.4.</span> <span class="toc-text">缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储"><span class="toc-number">1.5.</span> <span class="toc-text">存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basic_认证"><span class="toc-number">1.6.</span> <span class="toc-text">basic 认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BS加载性能"><span class="toc-number">1.7.</span> <span class="toc-text">BS加载性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#推送"><span class="toc-number">1.8.</span> <span class="toc-text">推送</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨域"><span class="toc-number">1.9.</span> <span class="toc-text">跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨窗口"><span class="toc-number">1.10.</span> <span class="toc-text">跨窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨线程"><span class="toc-number">1.11.</span> <span class="toc-text">跨线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨客户端/app"><span class="toc-number">1.12.</span> <span class="toc-text">跨客户端/app</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全"><span class="toc-number">1.13.</span> <span class="toc-text">安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结束"><span class="toc-number">1.14.</span> <span class="toc-text">结束</span></a></li></ol></li></ol>
		</div>
		
		<h1 id="Web数据交互艺术">Web数据交互艺术</h1>
<h3 id="课程对象">课程对象</h3>
<ul>
<li>前端开发人员</li>
<li>一线开发者、web前端编程技术了解者</li>
<li>作者：张楠</li>
</ul>
<h2 id="大纲">大纲</h2>
<ul>
<li>格式<ul>
<li>纯文本</li>
<li>xml</li>
<li>json</li>
</ul>
</li>
<li>http连接</li>
<li>缓存</li>
<li>存储<ul>
<li>cookie</li>
<li>localStorage/userData(xml存储640)</li>
<li>web sql、indexedDB</li>
</ul>
</li>
<li>推送<ul>
<li>轮询</li>
<li>长连接</li>
<li>flash</li>
<li>web socket</li>
<li>EventSource</li>
</ul>
</li>
<li>跨域<ul>
<li>JSONP </li>
<li>postMessage</li>
<li>CORS</li>
<li>iframe + header location</li>
</ul>
</li>
</ul>
<ul>
<li>跨线程<ul>
<li>postMessage</li>
</ul>
</li>
</ul>
<ul>
<li>跨窗口<ul>
<li>window.open</li>
<li>window.opener</li>
</ul>
</li>
<li>跨客户端/app<ul>
<li>android</li>
<li>ios</li>
</ul>
</li>
<li><p>BS加载性能</p>
<ul>
<li>压缩</li>
<li>cookie限制(带宽、服务端角度思维)</li>
<li>请求头(request header)</li>
<li>注意并发</li>
<li>预加载、懒加载</li>
<li>bigPipe</li>
</ul>
</li>
<li><p>安全</p>
<ul>
<li>https</li>
</ul>
</li>
</ul>
<h2 id="格式">格式</h2>
<ul>
<li>纯文本<ul>
<li>早期的设计用来传输和存储数据的格式，它的缺点很明显，可读性差、没有规范可言。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZhangNan05|Male|Baidu</div></pre></td></tr></table></figure>

<ul>
<li>XML(eXtensible Markup Language)可扩展标记语言<ul>
<li>缺点是有很多冗余内容，前端基本被淘汰了。现在使用场景一般是对流量不敏感的地方，比如百度视频的数据收录、百度地图底图渲染配置、微信的API都用了。</li>
</ul>
</li>
</ul>
<figure class="highlight XML"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">person</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>zhangnan05<span class="tag">&lt;/<span class="title">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">gender</span>&gt;</span>male<span class="tag">&lt;/<span class="title">gender</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">location</span>&gt;</span>beijing<span class="tag">&lt;/<span class="title">location</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">person</span>&gt;</span></div></pre></td></tr></table></figure>

<ul>
<li>JSON (JavaScript Object Notation)<ul>
<li>JSON与XML最大的不同在于XML是一个完整的标记语言，而JSON不是。这使得XML在程序判读上需要比较多的功夫。主要的原因在于XML的设计理念与JSON不同。XML利用标记语言的特性提供了绝佳的延展性（如XPath），在数据存储，扩展及高级检索方面具备对JSON的优势，而JSON则由于比XML更加小巧，以及浏览器的内建快速解析支持，使得其更适用于网络数据传输领域</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">    "<span class="attribute">name</span>": <span class="value"><span class="string">"zhangnan"</span></span>,</div><div class="line">    "<span class="attribute">gender</span>": <span class="value"><span class="string">"Male"</span></span>,</div><div class="line">    "<span class="attribute">location</span>": <span class="value"><span class="string">"beijing"</span></span>,</div><div class="line">    "<span class="attribute">height</span>": <span class="value"><span class="number">175</span> </span></div><div class="line"> }</div></pre></td></tr></table></figure>

<ul>
<li>JSON用严格的格式规范，FE同学容易忽略的点<ul>
<li>key必须用双引号<code>&quot;</code>包裹</li>
<li>不允许使用单引号<code>&#39;</code>替代双引号<code>&quot;</code></li>
<li><code>}</code>和<code>]</code>之前不允许有<code>,</code></li>
</ul>
</li>
</ul>
<h2 id="http协议">http协议</h2>
<ul>
<li><p>连接概述</p>
<ul>
<li>在服务器一般运行了多个服务软件，同时提供几种服务。每种服务都建立一个Socket(是对TCP/IP协议的封装和应用)，并绑定到一个端口上，不同的端口对应于不同的服务。</li>
<li><p>然后去<code>.com</code>(因为是baidu.com的上层域名)域名服务器申请授权域名权限，将<code>dns.baidu.com.</code>作为<code>baidu.com</code>域名服务器(负责所有<code>baidu.com</code>结尾的网站的域名与ip的记录)，然后在自己的域名服务器绑定<code>baidu.com</code>的ip为220.181.111.188。</p>
</li>
<li><p>客户端想要获取服务端数据(baidu.com)，首先使用socket建立连接，而socket只能通过ip和端口建立连接.</p>
</li>
<li>客户端首先一般(可以修改)先检查自己本地host(/etc/hosts)配置是否找到ip,如果没有使用本地配置文件(/etc/resolv.conf)得到dns服务器的IP(由运营商提供)，与(使用UDP协议)dns服务器连接查询。</li>
<li>dns服务器(基于UDP协议)接收请求之后，查看本身有沒有ip与域名的记录，有则直接返回ip，否则去root服务器去请求，root服务器查找自身，返回.com的服务器</li>
<li>dns服务器去请求<code>.com</code>服务器，然后接收到<code>.com</code>服务器返回.baidu.com的服务器地址(就是dns.baidu.com)</li>
<li>dns服务器请求接收到.baidu.com的服务器返回ip地址</li>
<li>查找成功，缓存起来并返回给客户端ip地址(这里会做一下网通/电信不同ip返回)</li>
<li>1、然后客户端的socket基于<a href="http://zh.wikipedia.org/zh/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE" target="_blank" rel="external">tcp/ip协议</a>与服务器220.181.111.188的里面端口号为<code>80</code>的socket经历三次握手之后连接成功      </li>
<li>2、客户端发送发送请求命令 GET/index.html http/1.1 (req)</li>
<li>3、客户端发送头信息(request header)</li>
<li>4、服务端对客户端做应答 HTTP/1.1 200 OK(如果状态码是300系列,则直接进入第七步；如果200系列则返回数据)</li>
<li>5、服务端返回应答头(response header)</li>
<li>6、服务器返回数据（response body）.</li>
<li>7、如果返回头(response header)没有设置Connection:keep-alive(HTTP持久连接)则关闭socket<br><img src="/img/1413562114362.png" alt="Alt text"></li>
</ul>
</li>
</ul>
<h2 id="缓存">缓存</h2>
<ul>
<li><p><code>If-Modified-Since/Last-modified</code>: 服务器程序检查请求头(<code>request header</code>)里面的(<code>If-modified-Since</code>)，如果最后修改时间相同(例如静态文件的Modified time 通过shell <code>ls -l</code>可以查看)则返回304，否则给返回头(<code>response header</code>)添加<code>last-Modified</code>并且返回数据(response body)。</p>
</li>
<li><p><code>If-None-Match/Etag</code>：服务器程序检查检查请求头(<code>request header</code>)里面的<code>if-none-match</code>的值与当前文件的内容通过hash算法（<code>例如 nodejs: cryto.createHash(&#39;sha1&#39;)</code>）生成的内容摘要字符对比，相同则直接返回<code>304</code>，否则给返回头(<code>response header</code>)添加<code>etag</code>属性为当前的内容摘要字符，并且返回内容。</p>
</li>
<li><p>如果设置了<code>Expires</code>(XX时间过期)或者<code>Cache-Control（http1.0不支持）</code>(经历XX时间后过期)且没有过期，命中<code>cache</code>的情况下会如果是在地址栏输入会<code>from cache</code>不去发起请求，如果强刷（如ctrl+r）会发起请求，但是如果没有修改会返回<code>304</code>内容未修改，如果已经改变则返回新内容。</p>
</li>
<li><p>expires/cache-control 虽然是强缓存，但用户主动触发的刷新行为，还是会采用缓存协商的策略，主动触发的刷新行为包括点击刷新按钮、右键刷新、f5刷新、ctrl+f5刷新等。</p>
</li>
<li>当然如果在控制台里面选中了<code>disable cahce</code>则无论如何都会请求最新内容，因为<br>1.不会检查本地是否有缓存。<br>2.请求头信息(request header)既没有If-Modified-Since也没有If-None-Match来让服务端判断。</li>
<li>如何清理缓存呢？<br>  因为浏览器根据url来判断进行缓存，1、修改文件名称。2、加时间戳。</li>
</ul>
<h2 id="存储">存储</h2>
<p><img src="/img/1414041670137.png" alt="Alt text"></p>
<ul>
<li>cookie <ul>
<li>Cookie 用于弥补 HTTP 协议的无状态性，服务器可以使用 Cookie 中包含的信息来判断 HTTP 传输中的状态。</li>
<li>看了前面的连接过程，让大家知道每次一个新连接都会把cookie数据带发送，站在前段角度也许一个请求几个字节的数据而已，但是应该站在服务器的角度，服务器每天面对上亿次请求，每个连接增加1kb，会导致整个服务新增`1E8k’kkk传输。</li>
</ul>
</li>
<li>localStorage/sissionStorage<ul>
<li>localStorage.setItem(key, value)//获取数据</li>
<li>localStorage.getItem(key, value)//添加数据</li>
<li>localStorage.clear()//清除所有数据</li>
<li>标准推荐每个域名最大存储限制5M</li>
<li>建议所有的接口都try catch捕捉一下错误，包括不限于意外报错防止不支持/超过限制大小/隐私模式等情况</li>
<li>可以通过postMessage来增加存储</li>
</ul>
</li>
<li>userData</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">id</span>=<span class="value">"userData"</span> <span class="attribute">class</span>=<span class="value">"storeuserData"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span></div><div class="line"><span class="class">.storeuserData</span> <span class="rules">{<span class="rule"><span class="attribute">behavior</span>:<span class="value"><span class="function">url</span>(<span class="hexcolor">#defa</span>ult#userData)</span></span>;<span class="rule">}</span></span></div><div class="line"><span class="tag">&lt;/<span class="title">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">//打开文件</span></div><div class="line"><span class="keyword">var</span> userData = <span class="built_in">document</span>.getElementById(<span class="string">'userData'</span>);</div><div class="line">userData.load(<span class="string">'baidu'</span>);</div><div class="line"><span class="comment">// 将传入的内容当作属性存储</span></div><div class="line">userData.setAttribute(<span class="string">"code"</span>, <span class="string">'这是我存储的内容zhangan05'</span>);</div><div class="line"><span class="comment">// 设置文件过期时间</span></div><div class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(), </div><div class="line">e = <span class="number">100</span>;</div><div class="line">d.setDate(d.getDate() + e);</div><div class="line">userData.expires = d.toUTCString();</div><div class="line"><span class="comment">// 存储为制定的文件名</span></div><div class="line">userData.save(<span class="string">'baidu'</span>);</div><div class="line"><span class="comment">//保存了baidu[1].xml文件，其中的内容是：&lt;ROOTSTUB code="hello,world!"/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<pre><code><span class="pp">- userData的时候其实是利用某个拥有特地属性的标签去写`XML`文件，然后你可以新建<span class="params">(load)</span>一个XML文件，去写属性，然后保存<span class="params">(save)</span>起来。
- 当然有限制:单个文件的大小限制是128KB<span class="params">(<span class="number">64</span>)</span>，一个域名下总共可以保存1024KB<span class="params">(<span class="number">640</span>)</span>的文件</span>
</code></pre><p><img src="/img/1414313413340.png" alt="Alt text"></p>
<ul>
<li><p>webSql</p>
<ul>
<li>使用SQL 语言为 SQLite 3.6.19。</li>
<li>在 2010 年 11 月 18 日，W3C 宣布弃用 Web SQL 数据库规范。</li>
</ul>
</li>
<li><p>indexedDB</p>
<ul>
<li>理解事务：一个数据库事务通常包含了一个序列的对数据库的读/写操作。它的存在包含有以下两个目的<ul>
<li>为数据库操作序列提供了一个从失败中恢复到正常状态的方法，同时提供了数据库即使在异常状态下仍能保持一致性的方法。</li>
<li>当多个应用程序在并发访问数据库时，可以在这些应用程序之间提供一个隔离方法，以防止彼此的操作互相干扰。</li>
</ul>
</li>
<li>用到了不少异步的API</li>
<li><a href="http://www.ibm.com/developerworks/cn/web/wa-indexeddb/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/web/wa-indexeddb/</a></li>
<li><a href="http://www.cnblogs.com/dolphinX/p/3415761.html" target="_blank" rel="external">http://www.cnblogs.com/dolphinX/p/3415761.html</a></li>
</ul>
</li>
</ul>
<h2 id="basic_认证">basic 认证</h2>
<p><img src="/img/1413527226420.png" alt="Alt text"></p>
<ul>
<li>通过请求头(request header)携带Authorization添加认证方式和加密值构成base64的结果,如果首次访问而且没有Authorization字段时，会返回401，浏览器接手后一般会弹出一个帐号密码输入弹出框。输入提交完成认证以后浏览器会保存用户名和密码，从而让进入页面直接携带密码。</li>
<li>缺点时传输过程base64几乎是明文存储(base64)，大部分情况是在https下使用。待会详细讲解https。</li>
</ul>
<h2 id="BS加载性能">BS加载性能</h2>
<ul>
<li>压缩<ul>
<li>gzip<ul>
<li>浏览器发送Http request 给Web服务器,  request 中有Accept-Encoding: gzip, deflate。 (告诉服务器， 浏览器支持gzip压缩)</li>
<li>Web服务器接到request后， 生成原始的Response, 其中有原始的Content-Type和Content-Length。</li>
<li>Web服务器通过Gzip，来对Response进行编码， 编码后header中有Content-Type和Content-Length(压缩后的大小)， 并且增加了Content-Encoding:gzip.  然后把Response发送给浏览器。</li>
<li>浏览器接到Response后，根据Content-Encoding:gzip来对Response 进行解码。 获取到原始response后， 然后显示出网页。</li>
</ul>
</li>
<li>代码压缩<ul>
<li>也就是针对html、js、css等资源进行压缩，减少体积。</li>
</ul>
</li>
</ul>
</li>
<li><p>注意并发</p>
<ul>
<li>浏览器对同一个域名有连接数限制，我们请求是尽量并行请求,例如纯前端webapp中尽量把数据请求提前，与其他的资源做并行加载。</li>
</ul>
</li>
<li><p>加载时机选择</p>
<ul>
<li>多思考浏览器加载时机<ul>
<li>预加载：比如最近做的『即时搜索』，在输入阶段判断给数据做加载</li>
<li>懒加载：仅仅展示当前视口内容，根据用户操作才做加载</li>
</ul>
</li>
</ul>
</li>
<li><p>bigpipe</p>
<ul>
<li>Http连接完成之后<ul>
<li>正常情况: 多块数据一次性发送过来。这样存在的问题是，有些数据可以很快的，也需要等到最慢的那份数据一起发送。</li>
<li>Bigpipe：先发送架构DOM结构（layout）(可能还会带有读取更快的数据块)。1、为了给其他数据块加载的时候有自己的『位置』。2、给用户更快的、更平滑的效果。<br>然后其他较慢数据块，通过把数据(大部分情况是通过模板已经拼接好的DOM结构)放到script标签里面执行js插入(innerHTML、appendChild)到对应的位置。</li>
</ul>
<ul>
<li>左侧导航都是静态数据<br><img src="/img/1414035202724.png" alt="Alt text"></li>
<li>[推荐模块]被展示出来<br><img src="/img/1414035255568.png" alt="Alt text"></li>
<li>[第一条状态]被展示<br><img src="/img/1414035345425.png" alt="Alt text"></li>
<li>展示完毕<br><img src="/img/1414035384261.png" alt="Alt text"></li>
</ul>
</li>
</ul>
<ul>
<li>容易误解的地方<ul>
<li>后面的数据块通过ajax加载的—-错</li>
<li>所有的网站都适合bigPipe方案—-错</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="推送">推送</h2>
<ul>
<li>场景：聊天室、在线游戏需要服务器即时主动推送消息</li>
</ul>
<ul>
<li>轮询<ul>
<li>轮询：客户端定时向服务器发送Ajax请求，服务器接到请求后马上返回响应信息并关闭连接。 </li>
<li>优点：后端程序编写比较容易。 </li>
<li>缺点：请求中有大半是无用，浪费带宽和服务器资源。 </li>
</ul>
</li>
<li>长轮询(长连接)：客户端向服务器发送Ajax请求，服务器与客户端socket连接之后,hold住连接(不做close)，直到有新消息才返回响应信息并关闭连接，客户端处理完响应信息后再向服务器发送新的请求。 <ul>
<li>优点：在无消息的情况下不会频繁的请求，耗费资源小。 </li>
<li>缺点：服务器hold连接会消耗资源，增加并发数。</li>
</ul>
</li>
<li>flash<ul>
<li>在页面中内嵌入一个使用了Socket类的 Flash 程序JavaScript通过调用此Flash程序提供的Socket接口与服务器端的Socket接口进行通信，JavaScript在收到服务器端传送的信息后控制页面的显示。</li>
<li>优点：实现真正的即时通信，而不是伪即时。 </li>
<li>缺点：客户端必须安装Flash插件；非HTTP协议，无法自动穿越防火墙。 </li>
</ul>
</li>
<li>webSocket<ul>
<li>HTML新方法真正实现主动推送</li>
<li>优点：标准方法，性能好</li>
<li>缺点：浏览器兼容性差，现代浏览器才支持</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> WebSocket(<span class="string">'ws://html5rocks.websocket.org/echo'</span>, [<span class="string">'soap'</span>, <span class="string">'xmpp'</span>]);</div><div class="line"><span class="comment">// When the connection is open, send some data to the server</span></div><div class="line">connection.onopen = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</div><div class="line">        connection.send(<span class="string">'Ping'</span>); <span class="comment">// Send the message 'Ping' to the server</span></div><div class="line">};</div><div class="line"><span class="comment">// Log errors</span></div><div class="line">connection.onerror = <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> </span>{</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'WebSocket Error '</span> + error);</div><div class="line">};</div><div class="line"><span class="comment">// Log messages from the server</span></div><div class="line">connection.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>{</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Server: '</span> + e.data);</div><div class="line">};</div><div class="line">connection.send(<span class="string">'hello baidu'</span>);</div></pre></td></tr></table></figure>

<ul>
<li>EventSource<ul>
<li>html code</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"result"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> source=<span class="keyword">new</span> EventSource(<span class="string">"demo_sse.php"</span>);</div><div class="line">    source.onmessage=<span class="function"><span class="keyword">function</span><span class="params">(event)</span></span>{</div><div class="line">      <span class="comment">//The server time is: Tue, 21 Oct 2014 14:32:43 +0800</span></div><div class="line">      <span class="built_in">document</span>.getElementById(<span class="string">"result"</span>).innerHTML+=event.data + <span class="string">"&lt;br /&gt;"</span>;</div><div class="line">    };</div><div class="line"> <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<pre><code><span class="addition">+ php code</span>
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line">    header(<span class="string">'Content-Type: text/event-stream'</span>);</div><div class="line">    header(<span class="string">'Cache-Control: no-cache'</span>);</div><div class="line">    <span class="variable">$time</span> = date(<span class="string">'r'</span>);</div><div class="line">    <span class="comment">//信息在格式上很简单，就是“信息”加上前缀“data: ”，然后以“\n\n”结尾。</span></div><div class="line">    <span class="variable">$data</span> = <span class="string">"The server time is: {$time}\n\n"</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"data: ${data}"</span>;</div><div class="line">    ob_flush();</div><div class="line">    flush();</div></pre></td></tr></table></figure>

<pre><code><span class="addition">+ websocket和EventSource的区别：</span>
1、WebSocket是全双工通道，可以双向通信，功能更强；SSE是单向通道，只能服务器向浏览器端发送
2、WebSocket是一个新的协议，需要服务器端支持；SSE则是部署在HTTP协议之上的，现有的服务器软件都支持。
3、SSE是一个轻量级协议，相对简单；WebSocket是一种较重的协议，相对复杂。
4、SSE默认支持断线重连，WebSocket则需要额外部署。
6、SSE支持自定义发送的数据类型。    
<span class="addition">+ 个人看法</span>
    - 分别用php版和nodejs版实现了一下，在Php版本里面是不断轮询请求。而nodejs里面则是hold住连接，不关闭，不断注入数据。所以个人感觉这货有点鸡肋，像是轮询和长轮询的结合。
</code></pre><h2 id="跨域">跨域</h2>
<ul>
<li>GET<ul>
<li>JSONP</li>
<li>postMessage<ul>
<li><a href="http://zhangnan.com/index.js" target="_blank" rel="external">http://zhangnan.com/index.js</a>;</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>{</div><div class="line">        <span class="built_in">console</span>.log(event.data);</div><div class="line">};</div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, onmessage, <span class="literal">false</span>);</div><div class="line"><span class="comment">//otherWindow.postMessage(message, targetOrigin);</span></div><div class="line">iframeElement.contentWindow.postMessage(<span class="string">'hello baidu.com'</span>, <span class="string">'http://www.baidu.com'</span>);</div></pre></td></tr></table></figure>

<pre><code>    -<span class="ruby"> <span class="symbol">http:</span>/<span class="regexp">/www.baiud.com/index</span>.js</span>
</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>{</div><div class="line">    <span class="built_in">console</span>.log(event.data, event.origin);</div><div class="line">    parent.postMessage(<span class="string">'hello zhangnan.com'</span>, event.origin);</div><div class="line">}, <span class="literal">false</span>);</div></pre></td></tr></table></figure>

<pre><code><span class="addition">+ CORS(Cross-Origin Resource Sharing)</span>
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//php code</span></div><div class="line">header(<span class="string">"Access-Control-Allow-Origin: http://www.a.com"</span>)</div></pre></td></tr></table></figure>

<ul>
<li>POST<ul>
<li>iframe + header location</li>
</ul>
</li>
</ul>
<h2 id="跨窗口">跨窗口</h2>
<ul>
<li>window.open();</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> childWindow = <span class="built_in">window</span>.open(<span class="string">"about:blank"</span>,<span class="string">"runWindow"</span>);</div><div class="line">childWindow.document.write(<span class="string">'&lt;script&gt;alert(123)&lt;/script&gt;'</span>);</div></pre></td></tr></table></figure>

<ul>
<li>window.opener</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 问题</span></div><div class="line"><span class="built_in">window</span>.opener.location.href = <span class="string">'http://baidu.com'</span></div></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 解决 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://qq.com"</span> <span class="attribute">rel</span>=<span class="value">"noreferrer"</span> <span class="attribute">target</span>=<span class="value">"_blank"</span>&gt;</span> new open <span class="tag">&lt;/<span class="title">a</span>&gt;</span></div></pre></td></tr></table></figure>

<h2 id="跨线程">跨线程</h2>
<ul>
<li>创建新的线程计算<ul>
<li>主脚本：</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">'doWork.js'</span>);</div><div class="line">worker.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>{</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Worker said: '</span>, e.data);</div><div class="line">}, <span class="literal">false</span>);</div><div class="line">worker.postMessage(<span class="string">'Hello World'</span>); <span class="comment">// Send data to our worker.</span></div></pre></td></tr></table></figure>

<pre><code>+ <span class="keyword">do</span>Work.js
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">self.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>{</div><div class="line">        self.postMessage(e.data);</div><div class="line">}, <span class="literal">false</span>);</div></pre></td></tr></table></figure>

<pre><code>+ 解释
主脚本给work.postMessage，会触发doWork里全局作用域(<span class="built_in">global</span> context)的message事件。而doWork里对全局作用域(<span class="built_in">global</span> context)调用postMessage,主线程会出发`<span class="javascript">message</span>`事件。
</code></pre><h2 id="跨客户端/app">跨客户端/app</h2>
<ul>
<li>iOS URL Schemes<ul>
<li>百度视频hd：BaiduVideoiPad:// 、baiduvideoipadapp://</li>
<li>百度浏览器hd：bdbrowser://</li>
<li>百度文库hd：bdwenku://</li>
<li>百度地图：baidumap://</li>
<li>百度音乐hd: BaiduMusicHD://</li>
<li>QQ：mqq:// </li>
<li>微信：weixin:// </li>
<li>美团：imeituan:// </li>
<li>京冬：openapp.jdmoble:// </li>
<li>人人：renren:// </li>
</ul>
</li>
</ul>
<ul>
<li>Smart App Banners</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;meta <span class="variable">name=</span><span class="string">"apple-itunes-app"</span> <span class="variable">content=</span><span class="string">"app-id=425692044, app-argument=appdp:275"</span>/&gt;</div></pre></td></tr></table></figure>

<p>app-id是你的app唯一id，可以在<a href="https://linkmaker.itunes.apple.com/us/?urlDesc=" target="_blank" rel="external">https://linkmaker.itunes.apple.com/us/?urlDesc=</a> 找到。<br>app-arguments是传给app的参数，app里面可以根据参数进入不同的页面。<br><img src="/img/1413879944317.png" alt="Alt text"></p>
<ul>
<li>android 后台 service</li>
<li>在android系统中你的app开启一个service来监听一个端口（如6249），然后通过jsonp思路和app进行信息交互</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">http:</span>/<span class="regexp">/127.0.0.1:6259/sendintent</span>?intent=<span class="comment">#Intent;</span></div></pre></td></tr></table></figure>

<h2 id="安全">安全</h2>
<ul>
<li><p>https(HTTP和TLS/SSL协议结合)</p>
<ul>
<li>为什么会有https存在：因为http几乎是明文传输，第三人在客户端与服务器之间<code>中间截获</code>之后可以窃取信息，而https可以密文传输。</li>
<li>目标<ul>
<li>防止服务端被假冒 — 数字证书（权威公证处）</li>
<li>防止客户端被假冒 — 非对称加密</li>
<li>防止数据传输被截获 — 对称加密</li>
</ul>
</li>
<li>https网站(例如：<a href="https://www.baidu.com" target="_blank" rel="external">https://www.baidu.com</a> ，默认使用443端口)找一个『证书中心』(certificate authority)开具证书，也就是证书中心用自己的私钥对这网址的公钥和<code>网址信息</code>加密生成”数字证书”(digital certificate)。</li>
<li><p>握手</p>
<ul>
<li>发送客户端支持的<code>生成hash算法</code>以及进行<code>加密算法</code>列表给服务端</li>
<li>服务端<code>数字证书(CA)</code>，加上从客户端发来的算法列表中确认一套<code>hash算法</code>和<code>加密算法</code>(例如AES)发给客户端。</li>
<li>浏览器看看证书是不是本地可信任机构颁发的证书，用可信任机构的公钥解开证书，获得该证书的网站地址、其他网址信息还有网址的公钥。看看证书是否过期，看看证书包含的网站地址是否和当前浏览的地址一致。确认使用的这一套hash算法和加密算法.<br>浏览器用生成一组随机数(就是一串用于对称加密的数字)。1、用这个随机数结合<code>加密算法</code>对握手消息（如：hello server）进行加密（对称加密）。2、对握手消息（如:hello server）使用确认好的hash算法生成数字摘要，然后用网站公钥加密数字摘要生成数字签名。3、用网站公钥对那一组随机数进行加密。发送到服务器。</li>
<li>服务器用网站私钥解开<code>加密过的随机数</code>获得<code>随机数</code>。用网站私钥解开<code>数字签名</code>获得<code>数字摘要</code>。用随机数结合约定好的加密算法解开<code>加密过的握手消息</code>获得<code>握手消息</code>(如：hello world)，用约定好的hash算法将握手消息（如:hello world）生成数字摘要，然后与刚刚用私钥解开的<code>数字摘要</code>做比较，来确认消息是否被修改过。</li>
</ul>
</li>
<li><p>数据传输</p>
<ul>
<li>准备好数据A（如：hello body），用约定好的加密算法结合发送过来的随机数对数据A进行加密（对称加密）。都发送给客户端。</li>
<li>客户端获取之后用随机数加约定好的加密算法对数据A进行解密。</li>
</ul>
</li>
<li><p>HTTPS报文中的任何东西都被加密，包括所有报头和荷载。一个攻击者所能知道的只有在两者之间有一连接这一事实。</p>
</li>
<li>之所以在前端开发工具(如chrome控制台)能看到https的请求详情，猜测是在对请求(request)公钥加密以前就获得了，这是浏览器内部实现。而第三方工具除非能改掉你的浏览器，否则最多能截获你的请求。  </li>
</ul>
</li>
</ul>
<h2 id="结束">结束</h2>
<ul>
<li>用户需求驱动技术发展</li>
<li>学习的不是仅仅技术，而是他的方法。比如为了网络通信安全和数据完整性保障，提供TLS协议这一套方案，如果你来做会怎么做？</li>
<li>没有了</li>
<li>q ? a : end;<div><br clear="none"></div></li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://js250.com/2015/02/15/web数据交互艺术/" data-title="web数据交互艺术 | microConan" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/02/15/vce-note/"  title="vce-note">
 <strong>NEXT:</strong><br/> 
 <span>vce-note
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web数据交互艺术"><span class="toc-number">1.</span> <span class="toc-text">Web数据交互艺术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#课程对象"><span class="toc-number">1.0.1.</span> <span class="toc-text">课程对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大纲"><span class="toc-number">1.1.</span> <span class="toc-text">大纲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#格式"><span class="toc-number">1.2.</span> <span class="toc-text">格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http协议"><span class="toc-number">1.3.</span> <span class="toc-text">http协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存"><span class="toc-number">1.4.</span> <span class="toc-text">缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储"><span class="toc-number">1.5.</span> <span class="toc-text">存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basic_认证"><span class="toc-number">1.6.</span> <span class="toc-text">basic 认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BS加载性能"><span class="toc-number">1.7.</span> <span class="toc-text">BS加载性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#推送"><span class="toc-number">1.8.</span> <span class="toc-text">推送</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨域"><span class="toc-number">1.9.</span> <span class="toc-text">跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨窗口"><span class="toc-number">1.10.</span> <span class="toc-text">跨窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨线程"><span class="toc-number">1.11.</span> <span class="toc-text">跨线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨客户端/app"><span class="toc-number">1.12.</span> <span class="toc-text">跨客户端/app</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全"><span class="toc-number">1.13.</span> <span class="toc-text">安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结束"><span class="toc-number">1.14.</span> <span class="toc-text">结束</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/express-framework-source-explain/" title="express framework source explain">express framework source explain<sup>1</sup></a></li>
		
			<li><a href="/tags/express-source/" title="express source">express source<sup>0</sup></a></li>
		
			<li><a href="/tags/nodejs-basic/" title="nodejs basic">nodejs basic<sup>1</sup></a></li>
		
		</ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/express-framework-source-explain/" style="font-size: 20.00px;">express framework source explain</a><a href="/tags/express-source/" style="font-size: 10.00px;">express source</a><a href="/tags/nodejs-basic/" style="font-size: 20.00px;">nodejs basic</a>
    </div>
  </div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">Archives</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">16</span></li></ul>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://js250.com" target="_blank" title="conan">conan</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"microsoft"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
