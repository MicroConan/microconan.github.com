
  
    <!DOCTYPE HTML>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
  
    <title>ipad+phone | microConan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="conan">
    
    <meta name="description" content="为什么重构、合并？

更方便维护，一份代码2个设备端
ipad迁入fis2
phone基于更加紧凑的逻辑实现ipad版架构来重构，
组件化可重用
减少人力浪费；

同一个功能2个端实现：

2人独自开发：有人力时间浪费，例如开发搜索结果页，超过90%功能相同，但是2个人各自想了一套实现逻辑，就有人力">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

      <body>
        <header>
          <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="microConan" title="microConan"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="microConan">microConan</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:js250.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

        </header>
        <div id="container">
          <div id="main" class="page" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/01/31/ipad+phone版本webapp响应时加载/" title="ipad+phone" itemprop="url">ipad+phone</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://js250.com" title="conan">conan</a>
    </p>
  <p class="article-time">
    <time datetime="2015-01-31T07:24:24.000Z" itemprop="datePublished">1月 31 2015</time>
    Updated:<time datetime="2015-01-31T07:29:49.000Z" itemprop="dateModified">1月 31 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<h1 id="为什么重构、合并？">为什么重构、合并？</h1>
<ul>
<li>更方便维护，一份代码2个设备端</li>
<li>ipad迁入fis2</li>
<li>phone基于更加紧凑的逻辑实现ipad版架构来重构，</li>
<li>组件化可重用</li>
<li><p>减少人力浪费；</p>
<blockquote>
<p>同一个功能2个端实现：</p>
<ul>
<li><p>2人独自开发：有人力时间浪费，例如开发搜索结果页，超过90%功能相同，但是2个人各自想了一套实现逻辑，就有人力浪费了。 </p>
</li>
<li><p>一个人负责2个端的功能，因为基础架构不同，代码肯定要重新修改，甚至需要开发完全不同的实现。</p>
</li>
</ul>
<p><strong>以上2中方案都会导致2份代码差距越来越大，人力浪费越来越多</strong></p>
</blockquote>
</li>
<li>工程师都不喜欢做重复的事情，而是更喜欢开发新功能</li>
<li>更方便统计，一份log统计</li>
<li>更加专注，体验更好</li>
<li>为将来优化方案做准备，nodejs吐出首屏页面</li>
<li>架构要求2者一致,保证充分分离充分紧贴，新功能迅速公用（例如极速搜索）</li>
<li>页面完全独立加载，从而有更大的优化空间，从极速搜索预加载的思路引出更多优化方案，充分发挥单页面闭环应用优势(single page web application）所有浏览端数据全部预加载不进行插入进行本地缓存，打开即可战士的思路，其实是最大限度利用浏览器的性能。这是多页面web无法做到的。</li>
<li><p>预加载页面关系</p>
<blockquote>
<p>频道页可以互相预加载</p>
<p>搜索首页—&gt;搜索结果页(极速搜索已经做了)</p>
<p>搜索结果页—&gt;详情页</p>
<p>详情页—-&gt;首页</p>
</blockquote>
</li>
<li>页面结构部分被提出来，仅仅保留页面最外层的盒子页面被抽空减少</li>
<li>实现css样式可以继承，可以销毁不占内存，。</li>
<li>公用样式被抽象分离出来公用，例如最常用海报，</li>
<li>样式细分公用<blockquote>
<p>无非2种：个体（视频海报、按钮）、结构（2栏、三栏）。</p>
</blockquote>
</li>
<li>实现将css+js+html+tpl形式独立组件，目的是文件公用，各种组件各种功能,更容易分离解耦合。</li>
<li>抽象整理统一化调起客户端方法。以前是2中data属性进行调起，现在合并在一个属性里。</li>
<li>用同一个属性(data-open)来储存调起参数，向上祖先节点寻找data-open-common属性做添加。<br>值以<code>key=value&amp;key2=value2</code>形式存储，例如调起失败时跳到这个属性<code>data-failedhref</code></li>
<li>可以给DOM添加事件监听的来做修改默认吊起方式，例如可以prevetDefault去掉默认的调起方式重新自定吊起方式，模拟浏览器事件</li>
</ul>
<h2 id="规范">规范</h2>
<p>一个页面只有一个amd模块，其他都inline进来。<br>原因：</p>
<ul>
<li>这样做既发挥了模块话依赖关系方式又发挥inline方式分离。</li>
<li>inline形式既可以使用公用js又可以区别化。</li>
<li>一个项目中fis的pack不支持同一个文件在打进多个包里面。</li>
<li>pack+inline是最佳实践</li>
</ul>
<h3 id="require声明依赖方式:">require声明依赖方式:</h3>
<ul>
<li>所有模块都以<code>main</code>文件夹作为入口，模仿<code>nodejs</code>里面的模块，<code>require</code>寻找一个模块时在对应文件夹下找到<code>package.json</code>里面的<code>main</code>属性作为入口文件名称。</li>
<li><p>模块以<code>/</code>开头，只会去寻找main目录下的模块文件，例如<code>detail</code>页面模块:<br><code>/develop/page/detail/___MEDIA___</code></p>
</li>
<li><p>所有的<code>require</code>尽量都写在main的目录下的文件里面:类似于书籍的目录，一目了然之后一个模块，包含哪些文件(inline),依赖哪些文件(require)。</p>
</li>
</ul>
<h3 id="同一个模块如何分离2个端(ipad+phone)的代码">同一个模块如何分离2个端(ipad+phone)的代码</h3>
<ul>
<li>在<code>main</code>文件夹下的添加2个端的入口,一个端一个入口，需要什么模块下的什么资源就inline进来。</li>
</ul>
<h3 id="同一个类(class)如何区分和公用？">同一个类(class)如何区分和公用？</h3>
<ul>
<li>给类添加<code>set</code>方法，可以设置类原型（prototype）上面的方法。</li>
</ul>
<h3 id="如何自动添加子View？">如何自动添加子<code>View</code>？</h3>
<ul>
<li>在元素容器($el)的子元素(element)写data-view属性进行添加自动添加，子<code>View</code>将会自动将其作为自己的元素容器(<code>$el</code>)。</li>
</ul>
<h3 id="多个页面子View如何沟通？">多个页面子<code>View</code>如何沟通？</h3>
<ul>
<li>尽量不沟通，只通过父<code>View</code>来处理。保证入口单一，充分分离。如果实在用沟通可以通过事件来交流。</li>
</ul>
<h3 id="特别慎重之慎重在View控制器里面使用全局的$选择符">特别慎重之慎重在<code>View</code>控制器里面使用全局的<code>$</code>选择符</h3>
<ul>
<li>只使用<code>this.$</code>这会只寻找自身容器元素(element)下的节点</li>
<li><p>保证一个<code>View</code>控制器的独立性，分离性。</p>
</li>
<li><p>子控制器加载完成之后应该trigger一次pageload事件<code>this.trigger(&#39;pageload&#39;, this)</code></p>
</li>
</ul>
<h3 id="如何使用海报组件？">如何使用<code>海报组件</code>？</h3>
<p>所有属性通过这种方式添加：</p>
<pre><code><span class="comment">//数据</span>
data = {
    <span class="comment">//海报a标签的属性，例如用于统计的`data-query`，用于调起的`data-open`，class</span>
    attributes = {
        data_query: <span class="number">123</span>,
        <span class="string">'data-open'</span>: <span class="string">'a=b&amp;c=d'</span>,
        <span class="keyword">class</span>: <span class="string">'123'</span>
    },
    <span class="comment">//视频名称</span>
    title: <span class="string">'天天向上'</span>,
    <span class="comment">//sub title，例如更新时间，时长，介绍等</span>
    sub_titles: [<span class="string">''</span>]
}
<span class="comment">//调用</span>
rocket.tpl.video({data:data});
</code></pre><h3 id="不再模板里面写for循环">不再模板里面写for循环</h3>
<ul>
<li><p>模板里面尽量不写if判断和each循环，用模块递归形式，</p>
<blockquote>
<p>大部分都要在js里面循环对各个单海报处理，加上模板里面，一共遍历了2次！</p>
<p>循环判断越多，层数越多越混乱，后期维护越来越难</p>
<p><a href="http://zhangnan.baidu.com/dropbox/code/test/execute.html" target="_blank" rel="external">减少遍历次数，性能差（with性能渣)</a></p>
</blockquote>
</li>
</ul>
<h3 id="添加根据兼容性使用效果三种交互类型">添加根据兼容性使用效果三种交互类型</h3>
<ol>
<li>scolll(这是异步加载的只在调用时)</li>
<li>scroll:fxied.</li>
<li>normal</li>
</ol>
<h3 id="交互优化">交互优化</h3>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://js250.com/2015/01/31/ipad+phone版本webapp响应时加载/" data-title="ipad+phone | microConan" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/01/31/2014-04-06-控制台打印加载时间做速度优化/" title="养成使用控制台打印加载时间的习惯">
  <strong>PREVIOUS:</strong><br/>
  <span>
  养成使用控制台打印加载时间的习惯</span>
</a>
</div>


<div class="next">
<a href="/2015/01/31/2014-03-28-基于fis扩展的fis-plus/"  title="">
 <strong>NEXT:</strong><br/> 
 <span>(no title)
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
        </div>
        <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://js250.com" target="_blank" title="conan">conan</a>
		
		</p>
</div>
</footer>
        <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"microsoft"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





      </body>
     </html>
     
